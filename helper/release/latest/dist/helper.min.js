/*
Copyright (c) Daybrush
name: @moveable/helper
license: MIT
author: Daybrush
repository: https://github.com/daybrush/moveable/blob/master/packages/helper
version: 0.1.3
*/
!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).MoveableHelper={})}(this,function(t){"use strict";var e=function(t,n){return(e=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(t,n){t.__proto__=n}:function(t,n){for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}))(t,n)};function i(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function a(t,n,r){if(r||2===arguments.length)for(var e,i=0,u=n.length;i<u;i++)!e&&i in n||((e=e||Array.prototype.slice.call(n,0,i))[i]=n[i]);return t.concat(e||Array.prototype.slice.call(n))}function f(t){return Array.isArray(t)}function r(t,n,r){n=function(t,n,r){void 0===r&&(r=-1);for(var e=t.length,i=0;i<e;++i)if(n(t[i],i,t))return i;return r}(t,n);return-1<n?t[n]:r}function s(t){return t.reduce(function(t,n){return f(n)?t.push.apply(t,s(n)):t.push(n),t},[])}var n=function(){function t(t){this.parent=t,this.type="single",this.depth=0,this._scope=[],t&&(this.depth=t.depth+1)}return Object.defineProperty(t.prototype,"scope",{get:function(){var t=this.parent;return t&&"root"!==t.type?a(a([],t.scope,!0),[t.id],!1):[]},enumerable:!1,configurable:!0}),t}(),h=function(r){function t(t,n){t=r.call(this,t)||this;return t.value=n,t.type="single",t}return i(t,r),t}(n),l=function(n){function o(){var t=null!==n&&n.apply(this,arguments)||this;return t.type="group",t.value=[],t.id="",t.map=new Map,t}i(o,n);var t=o.prototype;return t.compare=function(t,n){void 0===n&&(n=0);var t=s(t),r=this.map,e=t.length,i=r.size,u=i-e,t=t.filter(function(t){return r.has(t)}).length;return 0<n&&0<=u||0===n&&0==u?e===t:n<0&&u<=0&&i===t},t.has=function(t){return this.map.has(t)},t.contains=function(n){return!!this.has(n)||this.value.some(function(t){return"group"===t.type&&t.contains(n)})},t.findContainedChild=function(n){return r(this.value,function(t){return"single"===t.type?t.value===n:t.contains(n)})},t.findExactChild=function(t){var n=this.map;if(!f(t))return n.get(t);var t=s(t),r=t.length,n=n.get(t[0]);if(n)for(var e=n.parent;e;){if(e.map.size>=r)return e;e=e.parent}},t.findCommonParent=function(t){for(var n=this,r=1/0,e=t.map(function(t){return n.findExactChild(t)}),i=(e.forEach(function(t){t&&(r=Math.min(t.depth,r))}),this);r;){var u=function(){--r;var n=(e=e.map(function(t){for(var n=t;n&&n.depth!==r;)n=n.parent;return n})).find(function(t){return t});return n?e.every(function(t){return!t||t===n})?"break":void 0:{value:i}}();if("object"==typeof u)return u.value;if("break"===u)break}return e.find(function(t){return t})||this},t.findNextChild=function(n,t,r){var e=this,i=(void 0===t&&(t=this.toTargetGroups()),void 0===r&&(r=!0),null),u=t.length;return t.some(function(t){return!r&&1===u&&f(t)?i=e.findNextChild(n,t):(t=e.findExactChild(t))&&"map"in t&&t.map.has(n)?(i=t,!0):void 0}),i},t.findNextExactChild=function(t,n,r){void 0===r&&(r=this.toTargetGroups());t=this.findNextChild(t,r,!0);return t&&t.compare(n,-1)?t:null},t.findPureChild=function(n,t){var r=this,e=null,i=t.filter(function(t){return r.has(t)});return i.length?(this.value.some(function(t){if("single"!==t.type&&t.has(n)&&(e=t.findPureChild(n,i)))return!0}),e):this},t.findNextPureChild=function(t,n){var r=this.findNextChild(t);return r?r.findPureChild(t,n):null},t.toTargetGroups=function(){return this.value.map(function(t){return"single"===t.type?t.value:t.toTargetGroups()})},t.findArrayChild=function(r){var n,t=this.value,e=!1;return(e="root"!==this.type?t.every(function(n){return"single"===n.type?r.some(function(t){return n.value===t}):r.some(function(t){return f(t)&&n.findArrayChild(t)})}):e)&&r.length===t.length?this:(n=null,t.some(function(t){if("group"===t.type)return n=t.findArrayChild(r)}),n)},t.groupByPerfect=function(n){return this.value.filter(function(t){return"single"!==t.type?t.compare(n,-1):-1<n.indexOf(t.value)})},t.add=function(t){var r=this,e=this.value,i=this.map,u=this.depth;return t.forEach(function(t){var n;"groupId"in t?((n=new o(r)).id=t.groupId,n.depth=u+1,e.push(n),n.add(t.children)):f(t)?((n=new o(r)).depth=u+1,e.push(n),n.add(t)):(n="current"in t?t.current:t,(t=new h(r,n)).depth=u+1,e.push(t),i.set(n,t))}),e.forEach(function(t){"single"===t.type?i.set(t.value,t):t.map.forEach(function(t,n){i.set(n,t)})}),parent},o}(n);function c(t){return{raw:function(){return t},targets:function(){return function n(t){var r=[];return(t=void 0===t?[]:t).forEach(function(t){"single"===t.type?r.push(t.value):r.push(n(t.value))}),r}(this.raw())},flatten:function(){return s(this.targets())}}}var u=function(e){function t(t,n){var r=e.call(this)||this;return r.type="root",r._targets=[],r.set(t,n),r}i(t,e);var n=t.prototype;return n.set=function(t,n){var r=this,e=(void 0===n&&(n=[]),this.map=new Map,this.value=[],this.map),i=this.value;this.add(t),n.forEach(function(t){var n;e.has(t)||((n=new h(r,t)).depth=1,i.push(n),e.set(t,n))}),this._targets=n},n.selectSubChilds=function(t,n){t=this.findNextChild(n,t,!1),n=this.map.get(n);return c(t?[t]:n?[n]:[])},n.selectSingleChilds=function(t,n,r){var e=a([],t,!0);return r.forEach(function(t){t=e.indexOf(t);-1<t&&e.splice(t,1)}),n.forEach(function(t){e.push(t)}),c(this.toChilds(e))},n.selectCompletedChilds=function(t,n,e,i){var u=this,o=a([],t,!0),r=s(o);return e.forEach(function(t){var n,r=o.indexOf(t);(-1<r||(n=i?u.findNextChild(t,o):u.findNextExactChild(t,e,o))&&-1<(r=o.findIndex(function(t){return f(t)&&n.compare(t)})))&&o.splice(r,1)}),n.forEach(function(t){var n=u._findParentGroup(t,r).findContainedChild(t);"group"===(null==n?void 0:n.type)?o.push(n.toTargetGroups()):o.push(t)}),c(this.toChilds(o))},n.selectSameDepthChilds=function(t,n,e,i){var u=a([],t,!0),o=this.findCommonParent(u);return e.forEach(function(t){var n,r=u.indexOf(t);(-1<r||(n=i?o.findNextExactChild(t,e,u):o.findNextChild(t,u,!0))&&-1<(r=u.findIndex(function(t){return f(t)&&n.compare(t)})))&&u.splice(r,1)}),o.groupByPerfect(n).forEach(function(n){var t;"single"===n.type?u.push(n.value):(-1<(t=u.findIndex(function(t){return f(t)&&n.compare(t,1)}))&&u.splice(t,1),u.push(n.toTargetGroups()))}),c(this.toChilds(u))},n.toChilds=function(t){var r=this,e=[];return t.forEach(function(t){var n;f(t)?(n=r.findArrayChild(t))&&e.push(n):(n=r.map.get(t),e.push(n||new h(r,t)))}),e},n.toSingleChild=function(t,n){var r=this.map.get(t);return n?r||new h(this,t):r},n.findArrayChildById=function(r){var e=null;return this.value.some(function t(n){if("single"!==n.type)return n.id===r?(e=n,!0):n.value.some(t)}),e},n.group=function(t,n){var r,e,i=this,u=this.findCommonParent(t),o=t.map(function(t){return f(t)?i.findArrayChild(t):i.toSingleChild(t)});return o.every(function(t){return(null==t?void 0:t.parent)===u})?(r=new l(u),(e=u.value.filter(function(t){return-1===o.indexOf(t)})).unshift(r),r.add(n?s(t):t),u.value=e,this.set(this.toTargetGroups(),this._targets),r.toTargetGroups()):null},n.ungroup=function(t){var n,r=this,e=(1===t.length&&f(t[0])&&(t=t[0]),this.findCommonParent(t)),i=t.map(function(t){return f(t)?r.findArrayChild(t):r.toSingleChild(t)});return e.value.every(function(t){return-1<i.indexOf(t)})&&e!==this&&(t=e.parent)?((n=t.value.filter(function(t){return t!==e})).push.apply(n,e.value),t.value=n,this.set(this.toTargetGroups(),this._targets),e.toTargetGroups()):null},n._findParentGroup=function(t,n){if(n.length){t=this.map.get(t);if(t)for(var r=t.parent;r;){if(n.some(function(t){return r.contains(t)}))return r;r=r.parent}}return this},t}(l),o={__proto__:null,Child:n,GroupSingleChild:h,GroupArrayChild:l,toTargetList:c,GroupManager:u};module.exports=o,t.Child=n,t.GroupArrayChild=l,t.GroupManager=u,t.GroupSingleChild=h,t.default=o,t.toTargetList=c});
//# sourceMappingURL=helper.min.js.map
